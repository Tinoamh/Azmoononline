{% extends "base.html" %}
{% load static %}
{% block title %}ØªÙ‚ÙˆÛŒÙ… Ø¢Ù…ÙˆØ²Ø´ÛŒ Ø¯Ø§Ù†Ø´Ø¬Ùˆ{% endblock %}
{% block body_class %}student-calendar{% endblock %}

{% block extra_css %}
<link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css' rel='stylesheet' />
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js'></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/locales/fa.js"></script>
<style>
    body.student-calendar { background: linear-gradient(180deg, #f5f8ff 0%, #eef3ff 100%); }
    .calendar-container {
        max-width: 1100px;
        margin: 40px auto;
        padding: 20px;
        background: white;
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.08);
    }
    .page-header {
        background: linear-gradient(90deg, #3A6CF4 0%, #818cf8 100%);
        color: white;
        padding: 30px 40px;
        border-radius: 16px;
        margin-bottom: 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .page-title h1 { margin: 0; font-size: 28px; font-weight: 800; }
    .page-title p { margin: 8px 0 0; opacity: 0.9; font-size: 14px; }
    
    .legend {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
        background: #f1f5f9;
        padding: 15px;
        border-radius: 12px;
    }
    .legend-item { display: flex; align-items: center; gap: 8px; font-size: 14px; color: #334155; font-weight: 600; }
    .dot { width: 12px; height: 12px; border-radius: 50%; }
    .dot-green { background: #22c55e; }
    .dot-red { background: #ef4444; }
    .dot-blue { background: #3b82f6; }
    
    #calendar {
        font-family: 'Vazirmatn', sans-serif;
    }
    .fc-event {
        cursor: pointer;
        padding: 4px;
        font-size: 13px;
        border-radius: 6px;
        border: none;
    }
    .fc-toolbar-title { font-size: 20px !important; font-weight: 800; }
    .fc-button { background: #3A6CF4 !important; border: none !important; font-weight: 700 !important; }
    .fc-button:hover { background: #2E56D0 !important; }
    .fc-day-today { background: #eff6ff !important; }
</style>
{% endblock %}

{% block content %}
<div class="calendar-container">
    <div class="page-header">
        <div class="page-title">
            <h1>ğŸ“… ØªÙ‚ÙˆÛŒÙ… Ø¢Ù…ÙˆØ²Ø´ÛŒ Ù…Ù†</h1>
            <p>Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø¢ÛŒÙ†Ø¯Ù‡ Ùˆ Ø³ÙˆØ§Ø¨Ù‚ Ú¯Ø°Ø´ØªÙ‡</p>
        </div>
        <a href="/" class="btn-back" style="color:white;text-decoration:none;background:rgba(255,255,255,0.2);padding:8px 16px;border-radius:8px;font-size:14px;">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø®Ø§Ù†Ù‡</a>
    </div>

    <div class="legend">
        <div class="legend-item"><span class="dot dot-green"></span> Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø¢ÛŒÙ†Ø¯Ù‡</div>
        <div class="legend-item"><span class="dot dot-blue"></span> Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ú¯Ø²Ø§Ø±ÛŒ</div>
        <div class="legend-item"><span class="dot dot-red"></span> Ù¾Ø§ÛŒØ§Ù† ÛŒØ§ÙØªÙ‡</div>
    </div>

    <div id="calendar"></div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            locale: 'fa',
            direction: 'rtl',
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,listMonth'
            },
            events: [
                {% for event in events %}
                {
                    title: '{{ event.title }} ({{ event.time }})',
                    start: '{{ event.start }}',
                    backgroundColor: '{{ event.color }}',
                    borderColor: '{{ event.color }}',
                    url: '{{ event.url }}'
                },
                {% endfor %}
            ],
            eventClick: function(info) {
                if (info.event.url && info.event.url !== '#') {
                   // Let default link behavior happen
                } else {
                   info.jsEvent.preventDefault(); // don't let the browser navigate
                }
            }
        });
        calendar.render();
    });
</script>
{% endblock %}
